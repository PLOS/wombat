<VirtualHost *:80>
  DocumentRoot /var/www/ambra
  ServerAdmin admin@plos.org
  ServerName ${DX_HOST}
  AllowEncodedSlashes On

  <Directory /var/www/ambra/>
    Order Allow,Deny
    Allow from all
  </Directory>

  RewriteEngine on

  RewriteRule ^(.*)\.$ $1 [R=301]

  # wombat now handles all doi resolution, so redirect request to wombat
  # uses plosone token as default, and assumes wombat will detect the proper target journal
  Include conf/rewrite.d/detectify.conf
  RequestHeader add "X-Wombat-Serve" "%{serve}e"
  RewriteRule ^/(.*) https://${JOURNALS_HOST}/plosone/doi?id=$1 [NE,L,R=301]

  SetEnvIf User-Agent "KEMP.*" nolog
  SetEnvIf User-Agent "check_http.*" nolog
  CustomLog "|/usr/bin/logger -p local6.info -t journals" lb_vhost_combined env=!nolog
  CustomLog "|/usr/bin/cronolog /var/log/apache2/combined-%Y%m%d-access_log" lb_combined env=!nolog
</VirtualHost>
